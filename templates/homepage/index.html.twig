{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}

{% block body %}
    <div class="bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4">Book an Appointment</h1>

        <div id="calendar" class="mb-4">

        
            <button id="scheduleAnAppointment" type="button" data-modal-target="timepicker-modal" data-modal-toggle="timepicker-modal" class="text-gray-900 bg-white hover:bg-gray-100 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
            <svg class="w4 h-4 me-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v4a1 1 0 0 0 .293.707l3 3a1 1 0 0 0 1.414-1.414L13 11.586V8Z" clip-rule="evenodd"/>
            </svg>
                Schedule appointment
            </button>
            
            <!-- Main modal -->
            <div id="timepicker-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                <div class="relative p-4 w-full max-w-[23rem] max-h-full">
                    <!-- Modal content -->
                    <div class="relative bg-white rounded-lg shadow dark:bg-gray-800">
                        <!-- Modal header -->
                        <div class="flex items-center justify-between p-4 border-b rounded-t dark:border-gray-600">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                Schedule an appointment
                            </h3>
                            <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm h-8 w-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-toggle="timepicker-modal">
                                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                </svg>
                                <span class="sr-only">Close modal</span>
                            </button>
                        </div>
                        <!-- Modal body -->
                        <div class="p-4 pt-0">

                        
                           
                      <div id="datepicker-inline" inline-datepicker data-date="02/25/2024"></div>

                         
                            <label class="text-sm font-medium text-gray-900 dark:text-white mb-2 block">
                            Pick your time
                            </label>
                            <ul id="timetable" class="grid w-full grid-cols-3 gap-2 mb-5">
                                <li>
                                    <input type="radio" id="10-00" value="" class="hidden peer" name="timetable">
                                    <label for="10-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    10:00 AM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="10-30" value="" class="hidden peer" name="timetable">
                                    <label for="10-30"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    10:30 AM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="11-00" value="" class="hidden peer" name="timetable">
                                    <label for="11-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    11:00 AM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="11-30" value="" class="hidden peer" name="timetable">
                                    <label for="11-30"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    11:30 AM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="12-00" value="" class="hidden peer" name="timetable" checked>
                                    <label for="12-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    12:00 AM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="13-30" value="" class="hidden peer" name="timetable">
                                    <label for="12-30"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    01:30 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="14-00" value="" class="hidden peer" name="timetable">
                                    <label for="14-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    02:00 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="15-00" value="" class="hidden peer" name="timetable">
                                    <label for="15-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    03:00 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="16-00" value="" class="hidden peer" name="timetable">
                                    <label for="16-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    04:00 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="16-30" value="" class="hidden peer" name="timetable">
                                    <label for="16-30"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    04:30 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="17-00" value="" class="hidden peer" name="timetable">
                                    <label for="17-00"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    05:00 PM
                                    </label>
                                </li>
                                <li>
                                    <input type="radio" id="17-30" value="" class="hidden peer" name="timetable">
                                    <label for="17-30"
                                    class="inline-flex items-center justify-center w-full px-2 py-1 text-sm font-medium text-center hover:text-gray-900 dark:hover:text-white bg-white dark:bg-gray-800 border rounded-lg cursor-pointer text-gray-500 border-gray-200 dark:border-gray-700 dark:peer-checked:border-blue-500 peer-checked:border-blue-700 dark:hover:border-gray-600 dark:peer-checked:text-blue-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-600 dark:peer-checked:bg-blue-900">
                                    05:30 PM
                                    </label>
                                </li>
                            </ul>
                           <div style="display: flex; flex-direction: column; align-items: flex-start;">
    <!-- TÜKENİYOR -->
    <div style="display: flex; align-items: center; margin-bottom: 10px;">
        <div style="width: 50px; height: 50px; background-color: #FF0000; border: 1px solid #000; margin-right: 10px;"></div>
        <span>No available reservation times left.</span>
    </div>

    <!-- TÜKENMEK ÜZERE -->
    <div style="display: flex; align-items: center; margin-bottom: 10px;">
        <div style="width: 50px; height: 50px; background-color: #FFA500; border: 1px solid #000; margin-right: 10px;"></div>
        <span>Very few reservation times are left.</span>
    </div>

    <!-- YARISI DOLU -->
    <div style="display: flex; align-items: center;">
        <div style="width: 50px; height: 50px; background-color: #FFFF00; border: 1px solid #000; margin-right: 10px;"></div>
        <span>Running out.</span>
    </div>
</div>

                        </div>
                    </div>
                </div>
            </div>

        
        </div>



        <form action="{{ path('booking_store') }}" method="POST" class="bg-gray-100 p-4 rounded-lg shadow-md">

            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" id="name" name="name" required class="mt-1 p-2 w-full border border-gray-300 rounded-md">
            </div>

            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="email" name="email" required class="mt-1 p-2 w-full border border-gray-300 rounded-md">
            </div>

            <div class="mb-4">
                <label for="phone" class="block text-sm font-medium text-gray-700">Phone</label>
                <input type="text" id="phone" name="phone" required class="mt-1 p-2 w-full border border-gray-300 rounded-md">
            </div>

            <div class="hidden"> 
                <input name="date" type="text" value="" />
                <input name="time" type="text" value="" />
            </div>

            <div class="mb-4">
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Book Now
                </button>
            </div>

            {% for booking in bookings %}
                {# {{ dump(booking['timestamp'])}} #}
                {# <li>Booking Date: {{ booking }}</li> #}
            {% else %}
                <li>No items found</li>
            {% endfor %}

        </form>
    </div>


    
    <script>
    
        const scheduleAnAppointment = document.getElementById('scheduleAnAppointment');
         
        function handleButtonClick() {

            // Diğer butonlar için de aynı işlevi uygulayın
                document.querySelectorAll('.prev-btn, .next-btn, .view-switch, .datepicker-cell').forEach(element => {
                element.addEventListener('click', () => {
                    // Seçili günün timestamp değerini almak için gerekli mantığı ekleyin
                    console.log(element);

                    if( element.hasAttribute('data-date')){
                        var dataDate = element.getAttribute('data-date');
                    }

                    const selectedTimestamp = dataDate; // Bu, seçilen günün timestamp değeri olmalı

                    handleDaySelection(selectedTimestamp);
                });
            });

            document.querySelectorAll('.prev-btn, .next-btn, .view-switch').forEach(button => {
                button.addEventListener('click', handleButtonClick);
            });

            const radios = document.querySelectorAll('input[name="timetable"]');
            const datepickerCells = document.querySelectorAll('.datepicker-cell');
            const spanElement = document.querySelector('span[data-date="1708855402000"]');
            const dateInput = document.getElementsByName('date')[0];
            const timeInput = document.getElementsByName('time')[0];

            const data = {{ bookings|json_encode|raw }};

            document.querySelectorAll('span').forEach(span => {
                // Span'ın stilini temizleyelim
                span.style.backgroundColor = '';
                span.style.color = '';
                span.style.disabled = ''; // Bu özellik stil için geçerli değil, belki kaldırmak istiyorsunuz
            });

   

            // Her bir data-date değeri için döngü
            for (const [timestamp, value] of Object.entries(data)) {
                // data-date değeri ile eşleşen span öğelerini seç

                const spans = document.querySelectorAll(`span[data-date="${timestamp}"]`);
                
                if(value.times.length == 12){
                    spans.forEach(span => {
                        span.style.color = 'black';
                        span.style.backgroundColor = '#FF0000';
                        span.style.disabled = 'true';
                    });
                    continue;
                }

                if(value.times.length >= 8){
                    spans.forEach(span => {
                        span.style.color = 'black';
                        span.style.backgroundColor = '#FFA500';
                        span.style.disabled = 'true';
                    });
                    continue;
                }
              
                if(value.times.length >= 4){
                    spans.forEach(span => {
                        span.style.color = 'black';
                        span.style.backgroundColor = '#FFFF00';
                        span.style.disabled = 'true';
                    });
                    continue;
                }
            }

         

            radios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const selectedRadio = document.querySelector('input[name="timetable"]:checked');
                    const selectedId = selectedRadio ? selectedRadio.id : null;
                    console.log(`Seçili olan ID: ${selectedId}`);
                    timeInput.value = selectedId;
                });
            });

            datepickerCells.forEach(cell => {
                cell.addEventListener('click', () => {
                    dateInput.value = cell.dataset.date;
                });
            });

            if (spanElement) {
                spanElement.style.backgroundColor = "red";
                spanElement.style.color = "white";
                spanElement.style.disabled = "true";
                console.log("Span element bulundu:", spanElement);
            } else {
                console.log("Span element bulunamadı");
            }
        };

        document.querySelector('#scheduleAnAppointment').addEventListener('click', handleButtonClick);

     

        function handleDaySelection(selectedTimestamp) {
            
            const labels = document.querySelectorAll('label');

            

            labels.forEach(label => {

                
                label.style.backgroundColor = "";
                label.style.color = "";
                label.style.pointerEvents = "";

            })

                      
            const data = {{ bookings|json_encode|raw }};

            

            for (const item of Object.entries(data)) {
                const [timestamp, value] = item;

                if(timestamp == selectedTimestamp){
                    console.log(value.times)

                    value.times.forEach(time => {
                        var timeFormatted = time.replace(':', '-');
                        const label = document.querySelector(`label[for="${timeFormatted}"]`)

                        console.log(label);

                        label.style.backgroundColor = "red";
                        label.style.color = "white";
                        label.style.pointerEvents = "none";

                    })

                }
            }
        }
        
    </script>

{% endblock %}

